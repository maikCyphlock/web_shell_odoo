<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="web_shell.CacheViewer" owl="1">
        <div class="ws-cache-viewer h-100 d-flex flex-column p-2 bg-white">
            <h5 class="border-bottom pb-2 mb-0"><i class="fa fa-memory text-warning"></i> Cache Viewer</h5>
            
            <!-- Breadcrumbs -->
            <div t-if="state.history.length > 0" class="o_ws_breadcrumbs p-2 bg-light border-bottom small">
                <button t-if="state.history.length > 1" class="btn btn-sm btn-outline-secondary me-2 py-0" t-on-click="goBack" title="AtrÃ¡s">
                    <i class="fa fa-arrow-left"></i>
                </button>
                <t t-foreach="state.history" t-as="crumb" t-key="crumb_index">
                    <span t-if="!crumb_last" class="text-muted"><t t-esc="crumb.model"/>(<t t-esc="crumb.recordId"/>) / </span>
                    <span t-if="crumb_last" class="fw-bold text-primary"><t t-esc="crumb.model"/>(<t t-esc="crumb.recordId"/>)</span>
                </t>
            </div>

            <div class="p-3 flex-grow-1 d-flex flex-column overflow-hidden">
                <div class="row g-2 align-items-end mb-3">
                    <div class="col-md-5">
                        <label class="form-label small text-muted">Model</label>
                        <input type="text" class="form-control form-control-sm" t-model="state.model" placeholder="e.g. res.partner" t-on-keydown="onKeydown"/>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small text-muted">Record ID</label>
                        <input type="number" class="form-control form-control-sm" t-model="state.recordId" placeholder="e.g. 1" t-on-keydown="onKeydown"/>
                    </div>
                    <div class="col-md-4 d-flex gap-1">
                         <button class="btn btn-primary btn-sm flex-grow-1" t-on-click="inspectCache" t-att-disabled="state.loading">
                            <i t-if="state.loading" class="fa fa-spinner fa-spin"></i>
                            <span t-else="">Inspect</span>
                        </button>
                        <button t-if="state.model === 'ir.ui.view' and state.history.length > 0" 
                                class="btn btn-outline-primary btn-sm" 
                                t-on-click="() => props.onShowGraph(state.recordId)"
                                title="Ver Grafo de Herencia">
                            <i class="fa fa-sitemap"></i>
                        </button>
                    </div>
                </div>
                
                <div t-if="state.error" class="alert alert-danger p-2 small">
                    <i class="fa fa-exclamation-triangle"></i> <span t-esc="state.error"></span>
                </div>
                
                <div class="ws-cv-results flex-grow-1 overflow-auto border rounded bg-white" t-if="state.fields.length > 0">
                    <table class="table table-sm table-striped table-hover small m-0">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>Field</th>
                                <th>Value (Cached)</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="state.fields" t-as="field" t-key="field.field">
                                <td class="font-monospace text-primary" t-esc="field.field"></td>
                                <td class="text-break">
                                    <t t-if="field.relation">
                                        <a href="#" class="text-primary text-decoration-underline" 
                                           t-on-click.prevent="() => this.navigateToRelation(field.relation.model, field.relation.res_id)"
                                           t-att-title="'Inspeccionar ' + field.relation.display_name">
                                            <i class="fa fa-link me-1"></i>
                                            <t t-esc="field.value"/>
                                        </a>
                                    </t>
                                    <t t-else="">
                                        <t t-esc="field.value"/>
                                    </t>
                                </td>
                                <td class="text-muted" t-esc="field.type"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div t-elif="!state.loading and state.searched" class="text-center text-muted mt-5">
                    <i class="fa fa-info-circle mb-2"></i>
                    <p>No cached fields found for this record.</p>
                </div>
            </div>
        </div>
    </t>

</templates>
